<!DOCTYPE html>
<html lang="hu">
<head>
   <meta charset="UTF-8">
   <title>Go HTML p√©lda</title>
</head>
<body>
   <h1>Reg test</h1>
	<form id="regForm">
		<label for="name">Name:</label><br>
		<input type="text" id="name" name="name" maxlength="20" required><br>
  
		<label for="password">Password:</label><br>
		<input type="password" id="password" name="password" maxlength="20" required><br><br>

		<select name="role" id ="role">
			<option value="member">Member</option>
			<option value="admin">Admin</option>
		</select><br><br>
		<input type="hidden" id="csrf_token" name="csrf_token" value="{{.CSRFToken}}">
  		<button type="submit" id="sb">Submit</button>
	</form>
	<script>
		document.getElementById("regForm").addEventListener("submit", (e) => {
			e.preventDefault();

			const csrfToken = document.cookie
			 .split('; ')
			 .find(row => row.startsWith('csrf_token='))
			 ?.split('=')[1];

			const name = document.getElementById("name").value; 
			const password = document.getElementById("password").value; 
			const role = document.getElementById("role").value; 
			
			const formData = new URLSearchParams(); 
			formData.append("name", name); 
			formData.append("password", password); 
			formData.append("role", role); 

		  fetch("/submit_reg", {
			  method: "POST",
			  credentials: "include",
			  headers: {
				 "Content-Type": "application/x-www-form-urlencoded",
				 "X-CSRF-Token": csrfToken
			  },
			  body: formData.toString()
			})
			.then(res => res.json())
			.then(data => {
			  if (data.error) {
				 alert("Registration failed: " + data.error);
			  } else {
				 window.location.href = "/login";
			  }
			})
			.catch(err => {
			  console.error("Unexpected error:", err);
			});
		});
	</script>
</body>
</html>
